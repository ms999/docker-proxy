<Macro DockerProxy $port>
    # Docker pull-through proxy setup
    AllowEncodedSlashes NoDecode

    # Caching reverse proxy for Docker
    CacheEnable disk "/"
    CacheRoot "/var/cache/apache2/docker"
    CacheDirLevels 2
    CacheDirLength 1
    CacheLock on
    CacheLockPath "/tmp/docker-cache-lock"
    CacheLockMaxAge 5
    CacheIgnoreNoLastMod On
    CacheIgnoreQueryString Off
    CacheDefaultExpire 3600
    CacheMaxExpire 86400
    CacheIgnoreCacheControl On
    CacheStorePrivate On
    CacheStoreExpired On

    ProxyPass / https://registry-1.docker.io/ connectiontimeout=5 timeout=30 keepalive=On
    ProxyPassReverse / https://registry-1.docker.io/


    ErrorLog /usr/local/apache2/logs/docker_proxy_$port_error.log
    LogLevel proxy:debug ssl:debug debug
    CustomLog /usr/local/apache2/logs/docker_proxy_$port_access.log combined-cache

    SSLProxyEngine On
    # SSLProxyVerify require

    SSLProxyCheckPeerName off
    SSLProxyCheckPeerCN off

    ProxyRequests Off
    ProxyPreserveHost On
    <Proxy *>
        Require all granted
    </Proxy>


   # Header set Host "dev-machine.com"

    Header set "docker-distribution-api-version: registry/2.0"
    RequestHeader set X-Forwarded-Proto "https"

</Macro>
<VirtualHost *:8086>
    ServerName localhost:8086
    Use DockerProxy 8086
</VirtualHost>



ServerSignature On
ServerTokens Full

