<Macro DockerProxy $port>

    # Disable directory listing by default.
    <Directory />
      Require all denied
      Options None
      AllowOverride None
    </Directory>

    ErrorLog /usr/local/apache2/logs/docker_proxy_$port_error.log
    LogLevel proxy:debug ssl:debug debug
    CustomLog /usr/local/apache2/logs/docker_proxy_$port_access.log combined-cache
    ServerSignature Off
    SSLProxyCheckPeerName Off
    SSLProxyCheckPeerCN Off

    # Caching reverse proxy for Docker Hub
    #
    # General cache rules
    CacheRoot "/var/cache/apache2/dockerhub"
    CacheDirLevels 5
    CacheDirLength 2
    # SSL support
    SSLProxyEngine on
    # Prevent thundering herds.
    CacheLock on
    CacheLockPath "/tmp/mod_cache-lock"
    CacheLockMaxAge 5
    # 5GiB
    CacheMaxFileSize 5368709120
    # Ignore expire headers as Docker Hub uses immutable digests (e.g., sha256 hashes).
    CacheIgnoreQueryString On
    CacheDefaultExpire 86400
    CacheStoreExpired On

    # registry-1.docker.io
    CacheEnable disk "/"
    ProxyPass "/" "https://registry-1.docker.io/" ttl=120 keepalive=On retry=0
    ProxyPassReverse "/" "https://registry-1.docker.io/"
</Macro>
<VirtualHost *:8086>
    ServerName localhost:8086
    Use DockerProxy 8086
</VirtualHost>



ServerSignature On
ServerTokens Full

